<!DOCTYPE html>
<html>

<head>
	<%- include('../partials/head'); %>

	<!-- Main Script -->
	<script defer>
		// FUNCTIONS
		function customAlert(text, mode) {
			$("#div-alert").fadeOut(1000, function () {

				$("#div-alert").removeClass("alert-warning");
				$("#div-alert").removeClass("alert-success");
				$("#div-alert").removeClass("alert-danger");

				switch (mode) {
					case "success":
						$("#div-alert").addClass("alert-success");
						break;
					case "error":
						$("#div-alert").addClass("alert-danger");
						break;
					default:
						$("#div-alert").addClass("alert-info");
						break;
				}

				$("#div-alert").text(text);
				$("#div-alert").fadeIn(1000);
			});
		}
		function connectToChannel(name, password) {
			window.location.href = `${window.location.origin}/channel/${name}?pwd=${password}`;
		}

		$(document).ready(function () {
			$("#form-channel").submit(function (ev) {
				ev.preventDefault();

				// Get the channel information
				var data = {
					name: $("#txt-channel-name").val(),
					password: $("#txt-channel-password").val()
				};

				$.post('/create/channel/', data, function (response) {
					response = JSON.parse(response);
					console.log(response);

					// Give message
					customAlert(response.message, response.error ? "error" : "success");

					// Wait and redirect to newly created channel
					if (!response.error) {
						setTimeout(() => {
							connectToChannel(
								response.channel.name,
								response.channel.password
							);
						}, 2000);
					}
				});
			});
			$("#btn-connect").click(function () {
				connectToChannel(
					$("#txt-channel-name").val(),
					$("#txt-channel-password").val()
				);
			});
		});
	</script>
</head>

<body class="text-center">

	<header>
		<%- include('../partials/header'); %>
	</header>

	<br>

	<h1 class="display-3">SimuVid</h1>

	<div class="container form-container">
		<form id="form-channel" class="border border-secondary rounded">
			<div class="form-group">
				<label for="txt-channel-name">Channel Name</label>
				<input id="txt-channel-name" type="text" class="form-control" placeholder="Channel Name" />
			</div>
			<div class="form-group">
				<label for="txt-channel-password">Password</label>
				<input id="txt-channel-password" type="password" class="form-control" placeholder="Password">
				<small class="form-text text-muted">
					Have no idea of what to do?
					<br>
					Try reading the <a href="/what-to-do">Instructions</a>
				</small>
			</div>
			<div class="btn-group">
				<button type="submit" class="btn btn-primary">Create</button>
				<button id="btn-connect" class="btn btn-secondary">Connect</button>
			</div>
		</form>

		<br>

		<div id="div-alert" class="alert" style="display: none;"></div>
	</div>

	<% if (locals.alert) { %>
	<script>
		customAlert('<%= alertText %>', '<%= alertMode %>');
	</script>
	<% } %>
</body>

</html>