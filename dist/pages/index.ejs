<!DOCTYPE html>
<html>

<head>
	<%- include('../partials/head'); %>

	<!-- Main Script -->
	<script defer>
		function customAlert(text, mode) {
			$("#div-alert").fadeOut(1000, function () {

				$("#div-alert").removeClass("alert-warning");
				$("#div-alert").removeClass("alert-success");
				$("#div-alert").removeClass("alert-danger");

				switch (mode) {
					case "success":
						$("#div-alert").addClass("alert-success");
						break;
					case "error":
						$("#div-alert").addClass("alert-danger");
						break;
					default:
						$("#div-alert").addClass("alert-info");
						break;
				}

				$("#div-alert").text(text);
				$("#div-alert").fadeIn(1000);
			});
		}

		$(document).ready(function () {
			$("#form-channel").submit(function (ev) {
				ev.preventDefault();

				// Get the channel information
				var data = {
					name: $("#txt-channel-name").val(),
					password: $("#pass-channel").val()
				};

				$.post('/create/channel/', data, function (response) {
					response = JSON.parse(response);
					console.log(response);

					// Give message
					customAlert(response.message, response.error ? "error" : "success");

					// Wait and redirect to newly created channel
					if (!response.error) {
						setTimeout(() => {
							window.location.href = `${ window.location.origin}/channel/${response.channel.name}?pwd=${response.channel.password}`;
						}, 2000);
					}
				});
			});
		});
	</script>
</head>

<body class="text-center">

	<header>
		<%- include('../partials/header'); %>
	</header>

	<br>

	<h1 class="display-3">SimuVid</h1>

	<div class="container form-container">
		<form id="form-channel" class="border border-secondary rounded">
			<div class="form-group">
				<label for="txt-channel-name">Channel Name: </label>
				<input id="txt-channel-name" type="text" class="form-control" placeholder="Channel name" />
			</div>
			<div class="form-group">
				<label for="pass-channel">Password</label>
				<input id="pass-channel" type="password" class="form-control" placeholder="Password">
			</div>
			<button type="submit" class="btn btn-primary">Submit</button>
		</form>

		<br>

		<div id="div-alert" class="alert" style="display: none;"></div>
	</div>

	<% if (locals.alert) { %>
		<script>
			customAlert('<%= alertText %>', '<%= alertMode %>');
		</script>
	<% } %>
</body>

</html>